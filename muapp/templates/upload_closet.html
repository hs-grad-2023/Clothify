{% extends "base.html" %}
{% load static %}
{% block style %}
    <link href="{% static 'css/upload.css' %}" rel="stylesheet">
    <link href="https://releases.transloadit.com/uppy/v3.6.1/uppy.min.css" rel="stylesheet">
{% endblock style %}
{% block nav %}
    <a href="{% url 'index' %}" class="nav-item nav-link jamsil">Home</a>
    <a href="{% url 'index' %}" class="nav-item nav-link jamsil">Í∞ÄÏÉÅ ÌîºÌåÖ</a>
    <a href="{% url 'about' %}" class="nav-item nav-link jamsil">ÏÜåÍ∞ú</a>
{% endblock %}

{% block content %}
    <!-- Page Header Start -->
    <div class="container-xxl py-5">
        <!-- Page Header Start -->
        <div class="container">
            <div class="col-lg-6">
                <div class="section-header text-start mb-5 wow fadeInUp" style="bottom: 50px;top: 100px;" data-wow-delay="0.1s">
                    <h1 class="display-5 mb-3 jamsil" style="font-size: 4vw">ÎÇòÎßåÏùò Ïò∑Ïû•</h1>
                    <p class="jamsil">üëö Ïò∑ÏùÑ Îì±Î°ùÌï¥ÏÑú ÎÇòÎßåÏùò Ïò∑Ïû•ÏùÑ ÎßåÎì§Ïñ¥Ïöî.</p>
    
                 </div>
            </div>
        </div>
    </div>
    <!-- Page Header End -->
    <!-- Product Start -->
    <div class="container-xxl py-5">
        <div class="container">
            <div class="col text-start text-lg-end wow fadeInUp" data-wow-delay="0.1s">
                <a class="btn btn-lg btn-outline-primary border-2 jamsil" href="{% url 'view_closet' user.first_name %}">Î™©Î°ù</a>
            </div>
            <div class="row g-0 gx-5 align-items-end">
                <div class="col-lg-6">
                    <div class="section-header text-start mb-5 wow fadeInUp"
                         data-wow-delay="0.1s"
                         style="max-width: 500px">
                        <h1 class="display-5 mb-3 jamsil">Ïò∑Ïû• ÏóÖÎ°úÎìú</h1>
                    </div>
                </div>
            </div>
            <div class="tab-content jamsil wow fadeInUp" data-wow-delay="0.1s">
                <div id="tab-1" class="tab-pane fade show p-0 active">
                    <div class="row g-4">
                        <div>
                            <div id="att_zone" data-placeholder="">
                                <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s"></div>
                            </div>
                        </div>
                        <div>
                            <form action=""
                                  method="POST"
                                  name="clothesInfo"
                                  id="clothesInfo"
                                  enctype="multipart/form-data"
                                  onkeydown="return event.key != 'Enter';"
                                  onsubmit="return validationData"
                                  >
                                {% csrf_token %}
                                <div class="mb-3 row">
                                    <label for="type1" class="col-sm-2 col-form-label text-end fw-bold">Î∂ÑÎ•ò 1</label>
                                    <select name="type1" id="type1" size="1" class="form-select col" onchange="itemChange()">
                                        <option value="none" disabled selected>=== Î∂ÑÎ•ò 1 ===</option>
                                        <option>ÏÉÅÏùò</option>
                                        <option>Î∞îÏßÄ</option>
                                        <option>ÏπòÎßà</option>
                                        <option>ÏõêÌîºÏä§</option>
                                        <option>ÏïÑÏö∞ÌÑ∞</option>
                                        <option>Í∞ÄÎ∞©</option>
                                        <option>ÏïÖÏÑ∏ÏÑúÎ¶¨</option>
                                        <option>Ïã†Î∞ú</option>
                                    </select>
                                </div>
                                <div class="mb-3 row">
                                    <label for="type2" class="col-sm-2 col-form-label text-end fw-bold">Î∂ÑÎ•ò 2</label>
                                    <select name="type2" id="type2" size="1" class="form-select col">
                                        <option value="none" disabled selected>=== Î∂ÑÎ•ò 2 ===</option>
                                    </select>
                                </div>
                                <div class="mb-3 row">
                                    <label for="name" class="col-sm-2 col-form-label text-end fw-bold">Ïò∑ Ïù¥Î¶Ñ</label>
                                    <input type="text" name="clothesName" id="clothesName"class="form-control col" placeholder="(ÌïÑÏàò ÏûÖÎ†•)"/>
                                </div>
                                <!-- tag -->
                                <div class="mb-3 row">
                                    <label for="tag" class="col-sm-2 col-form-label text-end fw-bold">ÌÉúÍ∑∏</label>
                                    <input type="text" name="tag" id="tag" class="form-control col" 
                                    onkeyup="if(window.event.keyCode==13){addtag()}" placeholder="#Íæ∏ÏïàÍæ∏ #Ï∂úÍ∑ºÎ£© #Í∞ÄÏ£Ω #Ïä§Ïõ®Ïù¥Îìú (ÌäπÏàòÎ¨∏ÏûêüôÖ‚Äç‚ôÄÔ∏è)"/>
                                    <button type="button" id="btn-addtag" class="btn-addtag col-sm-2" onclick="addtag()">Ï∂îÍ∞Ä</button>
                                </div>
                                <!--tag Ï∂îÍ∞ÄÌï¥ÏÑú ÎùÑÏö∞Îäî label-->
                                <div class="mb-3 row">
                                    <label class="col-sm-2 col-form-label text-end"></label>
                                    <input type="text" name="tags" id="tags" class="form-control col" readonly/>
                                </div>
                                <div class="mb-3 row">
                                    <label for="details" class="col-sm-2 col-form-label text-end fw-bold">ÏÉÅÏÑ∏Ï†ïÎ≥¥</label>
                                    <textarea name="details" id="details" class="form-control col" rows="5" placeholder="ÏÉùÎûµ Í∞ÄÎä•"></textarea>
                                </div>
                                <!-- Uppy Dashboard -->
                                <div class="mb-3 row">
                                    <label class="col-sm-2"></label>
                                    <div class="fileUploadContent col"></div>
                                </div>

                                <!-- button design -->
                                <div class="btn-container" name="btn-container">
                                    <button id="btn-submit" class="btn-submit" type="sumbit" onkeyup="if(window.event.keyCode==13){}">
                                        <p class="jamsil" id="btnText">Ï†ÄÏû•</p>
                                        <div class="check-box">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
                                                <path fill="transparent" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
                                            </svg>
                                        </div>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Product End -->
{% endblock content %}

{% block jsv %}
<script defer src="{% static 'js/upload_closet.js' %}"></script>
<script defer src="https://releases.transloadit.com/uppy/v3.6.1/uppy.min.js"></script>
<script type="module">
    // import {Uppy, Dashboard, DropTarget, Compressor, XHRUpload, ImageEditor} from "https://releases.transloadit.com/uppy/v3.6.1/uppy.min.mjs"
    const COMPANION_URL = "http://companion.uppy.io"
    const COMPANION_ALLOWED_HOSTS = ['https://my-site.com']
    
    var uppy = new Uppy.Uppy({ logger: Uppy.debugLogger ,
                                meta: {
                                    type1: type1,
                                    type2: type2,
                                    tag: tag,
                                    name: clothesName,
                                    details: details
                                },
    })
    // const uppy = new Uppy({ logger: debugLogger })
        // The main UI that shows files, progress and holds all plugins
        .use(Uppy.Dashboard, {
            id: 'Dashboard',
            target: '.fileUploadContent',
            inline: true,
            height: 800,
            width: 1000,
            metaFields: [ //Ïù¥ÎØ∏ÏßÄ ÏàòÏ†ïÏö© metaFields
                { id: 'name', name: 'Name', placeholder: 'file name' },
                { id: 'caption', name: 'Caption', placeholder: 'add description' },
            ],
            note: 'Images only, Up to 10 files',
            produlyDisplayPoweredByUppy:false,
            autoOpenFileEditor: false,
        })

        .use(Uppy.Form, { 
                        target: '#clothesInfo',
                        getMetaFromForm: true,
                        addResultToForm: true,
                        triggerUploadOnSubmit: false,
                        submitOnSuccess: false})
        
        // Allow dropping files on any element or the whole document
        .use(Uppy.DropTarget, { target: document.body })
        // Optimize images
        .use(Uppy.Compressor)
        // Upload
        //.use(Uppy.Tus, { endpoint: 'https://tusd.tusdemo.net/files/' })
        .use(Uppy.XHRUpload,{
            endpoint: '{% url 'uploadCloset' user.username %}',
            headers: {'X-CSRFToken':"{{csrf_token}}"},
            formData: true,
            fileData: true,
            fieldName:'imgfile',
            allowedMetaFields:true,
        })

        .use(Uppy.ImageEditor, { target: Uppy.Dashboard })    



        // All remote services like Instagram and Google Drive in one package
        /*
        .use(Uppy.RemoteSources, {
            // You can manually specify `sources` here, by default all available are included. 
            // See docs: https://uppy.io/docs/remote-sources/#sources.
            companionUrl: COMPANION_URL,
            companionAllowedHosts: COMPANION_ALLOWED_HOSTS,
            sources: ['Instagram', 'GoogleDrive', 'Facebook', 'OneDrive', 'Url'],
        })
        .use(Uppy.Webcam, { target: Uppy.Dashboard })
        .use(Uppy.ScreenCapture, { target: Uppy.Dashboard }) 
         */
        
        
        uppy.on('complete', result => {
            console.log('successful files:', result.successful)
            console.log('failed files:', result.failed)
        })
</script>

{% endblock jsv%}
